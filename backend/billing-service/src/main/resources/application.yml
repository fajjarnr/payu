quarkus:
  application:
    name: billing-service

  http:
    port: 8085

  # Vault Configuration for Secrets
  vault:
    url: ${VAULT_URL:http://localhost:8200}
    authentication:
      token:
        token: ${VAULT_TOKEN:dev-only-token}
    secrets:
      - path: secret/billing-service
        key: encryption.key

  # Fault Tolerance Configuration
  fault-tolerance:
    enabled: true

    # Circuit Breaker
    circuit-breaker:
      wallet-service:
        request-volume-threshold: 20
        failure-ratio: 0.5
        delay: 30000
        success-threshold: 5

    # Retry
    retry:
      wallet-service:
        max-retries: 3
        delay: 1000
        max-duration: 10000
        jitter: 500
        retry-on:
          - java.io.IOException
          - java.net.ConnectException

    # Timeout
    timeout:
      wallet-service:
        duration: 5000

    # Bulkhead
    bulkhead:
      wallet-service:
        value: 20
        waiting-queue: 10

  otel:
    service:
      name: billing-service
    exporter:
      otlp:
        endpoint: ${OTEL_ENDPOINT:http://localhost:4317}
    resource:
      attributes:
        - service.name=billing-service
        - service.version=1.0.0

  datasource:
    db-kind: postgresql
    username: postgres
    password: postgres
    jdbc:
      url: jdbc:postgresql://localhost:5432/billingdb

  hibernate-orm:
    database:
      generation: validate
    log:
      sql: false
    packages: id.payu.billing.domain

  flyway:
    migrate-at-start: true
    locations: db/migration

  rest-client:
    wallet-service:
      url: http://localhost:8084
      scope: jakarta.enterprise.context.ApplicationScoped

  kafka:
    bootstrap-servers: localhost:9092

  smallrye-openapi:
    info-title: PayU Billing Service API
    info-version: 1.0.0
    info-description: Bill payment API for PLN, PDAM, Pulsa, etc.

  log:
    level: INFO
    category:
      "id.payu.billing":
        level: DEBUG

"%dev":
  quarkus:
    hibernate-orm:
      database:
        generation: drop-and-create
    flyway:
      migrate-at-start: false

"%test":
  quarkus:
    datasource:
      db-kind: h2
      jdbc:
        url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;MODE=PostgreSQL;IGNORE_UNKNOWN_SETTINGS=TRUE
      username: sa
      password:
    hibernate-orm:
      database:
        generation: drop-and-create
        dialect: org.hibernate.dialect.H2Dialect
      packages: id.payu.billing.domain
    flyway:
      migrate-at-start: false
    # Disable Kafka DevServices for tests - use In-Memory connector instead
    kafka:
      devservices:
        enabled: false
