# Test Configuration Template for FastAPI Services
# Copy to: tests/conftest.py

import pytest
import asyncio
from pathlib import Path

# Add src to Python path
sys.path.insert(0, str(Path(__file__).parent.parent / "src"))

# Session-scoped fixtures for database
@pytest.fixture(scope="session")
async def test_db_engine():
    """Create in-memory SQLite database for testing."""
    from sqlalchemy.ext.asyncio import create_async_engine
    from sqlalchemy.pool import StaticPool

    test_engine = create_async_engine(
        "sqlite+aiosqlite:///:memory:",
        echo=False,
        connect_args={"check_same_thread": False},
        poolclass=StaticPool,
    )

    async with test_engine.begin() as conn:
        await conn.run_sync(Base.metadata.create_all)

    yield test_engine
    await test_engine.dispose()

# NOTE: Do NOT create event_loop fixtures - pytest-asyncio handles this
# with asyncio_mode = "auto" in pyproject.toml
