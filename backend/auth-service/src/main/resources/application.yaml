server:
  port: 8082
  shutdown: graceful

spring:
  application:
    name: auth-service
  config:
    import: vault://

  cloud:
    vault:
      enabled: ${VAULT_ENABLED:true}
      uri: ${VAULT_URI:http://localhost:8200}
      token: ${VAULT_TOKEN:dev-only-token}
      scheme: http
      connection-timeout: 5000
      read-timeout: 15000
      kv:
        enabled: true
        backend: secret
        application-name: auth-service

  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${OIDC_ISSUER:http://localhost:8180/realms/payu}

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  tracing:
    sampling:
      probability: 0.1
  otlp:
    tracing:
      endpoint: ${OTEL_ENDPOINT:http://localhost:4317}
    headers:
      Authorization:
  zipkin:
    tracing:
      endpoint: ${OTEL_ENDPOINT:http://localhost:4317}/v1/spans

resilience4j:
  ratelimiter:
    instances:
      loginRateLimiter:
        limit-for-period: 5
        limit-refresh-period: 1m
        timeout-duration: 0s
        register-health-indicator: true
  circuitbreaker:
    instances:
      keycloakService:
        register-health-indicator: true
        sliding-window-type: count_based
        sliding-window-size: 10
        minimum-number-of-calls: 5
        failure-rate-threshold: 50
        wait-duration-in-open-state: 30s
        permitted-number-of-calls-in-half-open-state: 3
  retry:
    instances:
      keycloakService:
        max-attempts: 3
        wait-duration: 1s
        enable-exponential-backoff: true
        exponential-backoff-multiplier: 2

# Account Lockout Configuration
payu:
  security:
    max-login-attempts: 5
    lockout-duration-minutes: 15
    password-policy:
      min-length: 8
      require-uppercase: true
      require-lowercase: true
      require-digit: true
      require-special-char: true
  biometric:
    challenge-expiry-seconds: 300
    max-registrations-per-user: 5
  keycloak:
    server-url: ${KEYCLOAK_URL:http://localhost:8180}
    realm: ${KEYCLOAK_REALM:payu}
    client-id: ${KEYCLOAK_CLIENT_ID:auth-service}
    client-secret: ${KEYCLOAK_CLIENT_SECRET:secret}
    admin:
      username: ${KEYCLOAK_ADMIN_USERNAME:admin}
      password: ${KEYCLOAK_ADMIN_PASSWORD:admin}
